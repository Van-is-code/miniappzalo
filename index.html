<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>SmartDoor ¬∑ Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b24;
      --surface2: #1c2333;
      --border: rgba(255,255,255,0.06);
      --border2: rgba(255,255,255,0.1);
      --text: #e6edf3;
      --text2: #7d8590;
      --text3: #3d444d;
      --blue: #38bdf8;
      --blue-dim: rgba(56,189,248,0.1);
      --green: #3fb950;
      --green-dim: rgba(63,185,80,0.1);
      --red: #f85149;
      --red-dim: rgba(248,81,73,0.1);
      --amber: #f0883e;
      --purple: #818cf8;
    }
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body {
      background:#080b10;
      display:flex; justify-content:center; align-items:center;
      min-height:100vh; overflow:hidden;
      font-family:'Inter',sans-serif;
    }

    /* ‚îÄ‚îÄ PHONE ‚îÄ‚îÄ */
    .phone {
      width:390px; height:844px;
      background:var(--bg);
      border-radius:50px;
      border:1px solid rgba(255,255,255,0.07);
      box-shadow: 0 0 0 7px #080b10, 0 0 0 9px #10151e, 0 60px 120px rgba(0,0,0,0.9);
      position:relative; overflow:hidden;
      display:flex; flex-direction:column;
    }

    .phone::before {
      content:'';
      position:absolute; inset:0;
      background-image:
        linear-gradient(rgba(56,189,248,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(56,189,248,.03) 1px, transparent 1px);
      background-size:32px 32px;
      pointer-events:none; z-index:0;
    }

    .phone::after {
      content:'';
      position:absolute; top:30%; left:50%; transform:translate(-50%,-50%);
      width:320px; height:320px; border-radius:50%;
      background:radial-gradient(circle, rgba(56,189,248,.07) 0%, transparent 65%);
      pointer-events:none; z-index:0;
    }

    .island {
      position:absolute; top:12px; left:50%; transform:translateX(-50%);
      width:115px; height:33px; background:#000;
      border-radius:20px; z-index:100;
      display:flex; align-items:center; justify-content:center; gap:9px;
    }
    .island-cam { width:11px;height:11px;border-radius:50%;background:#111;border:1.5px solid #1c1c1c; }
    .island-mic { width:5px;height:5px;border-radius:50%;background:#1a1a1a; }

    .sb {
      height:52px; display:flex; align-items:flex-end;
      justify-content:space-between; padding:0 26px 8px; flex-shrink:0; position:relative; z-index:2;
    }
    .sb-t { font-family:'JetBrains Mono',monospace; font-size:14px; font-weight:500; color:var(--text); }
    .sb-r { display:flex; gap:5px; align-items:center; }
    .sb-bars { display:flex;gap:2px;align-items:flex-end; }
    .sb-b { background:var(--text); border-radius:1px; width:3px; }
    .sb-bat { width:21px;height:10px;border:1.5px solid rgba(255,255,255,.3);border-radius:3px;display:flex;align-items:center;padding:1.5px;position:relative; }
    .sb-bat::after { content:'';position:absolute;right:-3px;top:50%;transform:translateY(-50%);width:2px;height:5px;background:rgba(255,255,255,.3);border-radius:0 1px 1px 0; }
    .sb-bf { height:100%;width:80%;background:var(--green);border-radius:1.5px; }

    /* ‚îÄ‚îÄ LOGIN PAGE ‚îÄ‚îÄ */
    #loginPage {
      flex:1; position:relative; z-index:1;
      display:flex; flex-direction:column;
      padding:0 28px 40px;
      overflow:hidden;
    }

    .logo-block {
      display:flex; flex-direction:column; align-items:center;
      padding-top:28px; margin-bottom:32px;
    }

    .reactor {
      position:relative; width:80px; height:80px;
      display:flex; align-items:center; justify-content:center;
      margin-bottom:18px;
    }
    .r-ring1 {
      position:absolute; inset:0; border-radius:50%;
      border:1px solid rgba(56,189,248,.22);
      animation:spin 10s linear infinite;
    }
    .r-ring1::before {
      content:''; position:absolute;
      top:-3px; left:50%; transform:translateX(-50%);
      width:6px; height:6px; border-radius:50%;
      background:var(--blue); box-shadow:0 0 10px var(--blue), 0 0 20px rgba(56,189,248,.4);
    }
    .r-ring2 {
      position:absolute; inset:10px; border-radius:50%;
      border:1px solid rgba(56,189,248,.12);
      animation:spin 6s linear infinite reverse;
    }
    .r-ring2::after {
      content:''; position:absolute;
      bottom:-3px; left:50%; transform:translateX(-50%);
      width:4px; height:4px; border-radius:50%;
      background:rgba(56,189,248,.6); box-shadow:0 0 6px var(--blue);
    }
    .r-ring3 {
      position:absolute; inset:20px; border-radius:50%;
      border:1px solid rgba(56,189,248,.07);
    }
    .r-hex {
      width:28px; height:28px; position:relative;
      display:flex; align-items:center; justify-content:center;
    }
    .r-core {
      width:28px; height:28px; border-radius:50%;
      background:radial-gradient(circle, rgba(56,189,248,1) 0%, rgba(56,189,248,.5) 40%, rgba(56,189,248,.1) 70%, transparent 100%);
      box-shadow: 0 0 14px rgba(56,189,248,.9), 0 0 30px rgba(56,189,248,.4), 0 0 60px rgba(56,189,248,.15);
      animation:corePulse 2.5s ease-in-out infinite;
    }
    @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    @keyframes corePulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(.85)}}

    .r-pulse {
      position:absolute; inset:-14px; border-radius:50%;
      border:1px solid rgba(56,189,248,.1);
      animation:rpulse 2.5s ease-out infinite;
    }
    .r-pulse2 {
      position:absolute; inset:-26px; border-radius:50%;
      border:1px solid rgba(56,189,248,.05);
      animation:rpulse 2.5s ease-out infinite .6s;
    }
    @keyframes rpulse{0%{opacity:.8;transform:scale(.9)}100%{opacity:0;transform:scale(1.15)}}

    .brand-name {
      font-family:'JetBrains Mono',monospace;
      font-size:22px; font-weight:700; color:var(--text);
      letter-spacing:4px; text-transform:uppercase;
    }
    .brand-name span { color:var(--blue); }
    .brand-tag {
      font-family:'JetBrains Mono',monospace;
      font-size:9px; color:rgba(56,189,248,.4);
      letter-spacing:3.5px; margin-top:5px;
      text-transform:uppercase;
    }

    .form-card {
      background:var(--surface);
      border:1px solid var(--border2);
      border-radius:24px;
      padding:24px 22px 22px;
      position:relative; overflow:hidden;
      flex-shrink:0;
    }
    .form-card::before {
      content:''; position:absolute; top:0; left:30px; right:30px; height:1px;
      background:linear-gradient(90deg,transparent,rgba(56,189,248,.5),transparent);
    }
    .form-card::after {
      content:''; position:absolute; bottom:0; left:60px; right:60px; height:1px;
      background:linear-gradient(90deg,transparent,rgba(255,255,255,.04),transparent);
    }

    .form-ttl {
      font-family:'JetBrains Mono',monospace;
      font-size:9px; color:var(--text3); letter-spacing:3px;
      text-transform:uppercase; text-align:center;
      margin-bottom:20px;
      display:flex; align-items:center; gap:10px;
    }
    .form-ttl::before,.form-ttl::after { content:'';flex:1;height:1px;background:var(--border); }

    .inp-wrap {
      position:relative; margin-bottom:12px;
    }
    .inp-icon {
      position:absolute; left:14px; top:50%; transform:translateY(-50%);
      font-size:16px; pointer-events:none; z-index:1;
      filter:grayscale(1); opacity:.4; transition:opacity .2s;
    }
    .inp-wrap:focus-within .inp-icon { opacity:.9; filter:none; }

    .f-inp {
      width:100%;
      background:var(--bg);
      border:1px solid var(--border2);
      border-radius:14px;
      padding:14px 14px 14px 44px;
      color:var(--text);
      font-family:'JetBrains Mono',monospace;
      font-size:13px; font-weight:500;
      outline:none;
      transition:border-color .2s, box-shadow .2s;
      -webkit-appearance:none;
    }
    .f-inp::placeholder { color:var(--text3); font-weight:400; }
    .f-inp:focus {
      border-color:rgba(56,189,248,.5);
      box-shadow:0 0 0 3px rgba(56,189,248,.08), 0 0 20px rgba(56,189,248,.04);
    }

    .eye-btn {
      position:absolute; right:14px; top:50%; transform:translateY(-50%);
      background:none; border:none; cursor:pointer;
      font-size:16px; opacity:.35; transition:opacity .18s; padding:2px;
      color:var(--text2);
    }
    .eye-btn:hover { opacity:.7; }

    .meta-row {
      display:flex; justify-content:space-between; align-items:center;
      margin:14px 0 20px;
    }
    .rem-wrap { display:flex; align-items:center; gap:8px; cursor:pointer; }
    .rem-box {
      width:18px; height:18px; border-radius:5px;
      border:1.5px solid var(--border2);
      background:var(--bg);
      display:flex; align-items:center; justify-content:center;
      transition:all .18s; flex-shrink:0;
    }
    .rem-box.on { background:rgba(56,189,248,.15); border-color:rgba(56,189,248,.4); }
    .rem-box.on::after { content:'‚úì'; font-size:10px; font-weight:700; color:var(--blue); line-height:1; }
    .rem-lbl { font-size:12px; color:var(--text2); font-weight:500; }
    .forgot { font-size:12px; color:var(--blue); font-weight:600; cursor:pointer; opacity:.8; transition:opacity .18s; }
    .forgot:hover { opacity:1; }

    .login-btn {
      width:100%; height:52px; border:none; border-radius:16px;
      background:linear-gradient(135deg, #38bdf8 0%, #2563eb 100%);
      color:#fff; font-family:'JetBrains Mono',monospace;
      font-size:13px; font-weight:700; letter-spacing:2px;
      cursor:pointer; position:relative; overflow:hidden;
      transition:all .22s cubic-bezier(.34,1.5,.64,1);
      box-shadow: 0 0 0 0 rgba(56,189,248,.3), 0 8px 24px rgba(37,99,235,.4);
    }
    .login-btn::before {
      content:''; position:absolute; top:0; left:0; right:0; height:50%;
      background:linear-gradient(180deg, rgba(255,255,255,.15), transparent);
      border-radius:16px 16px 0 0;
    }
    .login-btn:hover {
      transform:translateY(-1px);
      box-shadow: 0 0 0 6px rgba(56,189,248,.1), 0 12px 32px rgba(37,99,235,.5);
    }
    .login-btn:active { transform:scale(.97); }
    .login-btn.loading { pointer-events:none; }
    .login-btn.loading .btn-txt { opacity:0; }
    .login-btn.loading .btn-spin { opacity:1; }
    .btn-txt { transition:opacity .18s; }
    .btn-spin {
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      opacity:0; transition:opacity .18s;
    }
    .spin-ring {
      width:22px; height:22px; border-radius:50%;
      border:2.5px solid rgba(255,255,255,.3);
      border-top-color:#fff;
      animation:spin .8s linear infinite;
    }

    .login-btn::after {
      content:''; position:absolute;
      top:-100%; left:0; right:0; height:100%;
      background:linear-gradient(180deg, transparent, rgba(255,255,255,.08), transparent);
      animation:scanline 3s linear infinite;
    }
    @keyframes scanline{0%{top:-100%}100%{top:200%}}

    .divider {
      display:flex; align-items:center; gap:12px;
      margin:18px 0 16px;
    }
    .divider::before,.divider::after { content:''; flex:1; height:1px; background:var(--border); }
    .divider-txt { font-family:'JetBrains Mono',monospace; font-size:9px; color:var(--text3); letter-spacing:2px; }

    .bottom-links {
      text-align:center; margin-top:20px;
      font-size:12px; color:var(--text3);
    }
    .bottom-links a { color:var(--blue); font-weight:600; cursor:pointer; opacity:.8; transition:opacity .18s; }
    .bottom-links a:hover { opacity:1; }

    .sys-bar {
      display:flex; align-items:center; justify-content:center; gap:14px;
      margin-top:20px; padding-top:16px;
      border-top:1px solid var(--border);
    }
    .sys-dot {
      display:flex; align-items:center; gap:5px;
      font-family:'JetBrains Mono',monospace;
      font-size:8px; color:var(--text3); letter-spacing:1px;
    }
    .sd { width:4px; height:4px; border-radius:50%; }
    .sd.ok { background:var(--green); box-shadow:0 0 5px var(--green); animation:sdot 2s infinite; }
    @keyframes sdot{0%,100%{opacity:1}50%{opacity:.3}}

    .err-msg {
      display:flex; align-items:center; gap:8px;
      background:rgba(248,81,73,.08); border:1px solid rgba(248,81,73,.2);
      border-radius:10px; padding:10px 12px; margin-bottom:12px;
      font-size:12px; color:var(--red); font-weight:500;
      opacity:0; transform:translateY(-6px);
      transition:all .3s cubic-bezier(.34,1.5,.64,1);
      pointer-events:none;
    }
    .err-msg.show { opacity:1; transform:translateY(0); pointer-events:all; }
    .err-ico { font-size:14px; flex-shrink:0; }

    .success-overlay {
      position:absolute; inset:0; z-index:200;
      background:var(--bg);
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:16px;
      opacity:0; pointer-events:none;
      transition:opacity .4s;
    }
    .success-overlay.show { opacity:1; pointer-events:all; }
    .suc-ring {
      width:80px; height:80px; border-radius:50%;
      border:2px solid var(--green);
      display:flex; align-items:center; justify-content:center;
      box-shadow: 0 0 0 10px rgba(63,185,80,.07), 0 0 30px rgba(63,185,80,.3);
      animation:sucPop .4s cubic-bezier(.34,1.5,.64,1);
    }
    @keyframes sucPop{from{transform:scale(.5);opacity:0}to{transform:scale(1);opacity:1}}
    .suc-check { font-size:32px; }
    .suc-txt { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; color:var(--green); letter-spacing:2px; }
    .suc-sub { font-size:12px; color:var(--text3); }

    /* ‚îÄ‚îÄ MAIN APP STYLES ‚îÄ‚îÄ */
    #appPage {
      flex:1; position:relative; z-index:1;
      display:none; flex-direction:column;
    }

    .pages { flex:1; position:relative; overflow:hidden; }
    .page {
      position:absolute; inset:0;
      overflow-y:auto; overflow-x:hidden; padding-bottom:110px;
      opacity:0; transform:translateY(10px); pointer-events:none;
      transition:opacity .26s ease, transform .26s ease; scrollbar-width:none;
    }
    .page::-webkit-scrollbar{display:none;}
    .page.active { opacity:1; transform:translateY(0); pointer-events:all; }

    .hud-header {
      margin:14px 20px 0;
      background:var(--surface);
      border:1px solid rgba(56,189,248,0.12);
      border-radius:16px;
      padding:14px 16px;
      position:relative; overflow:hidden;
      display:flex; align-items:center; gap:14px;
    }
    .hud-header::before {
      content:''; position:absolute; top:0; left:0; right:0; height:1px;
      background:linear-gradient(90deg,transparent,rgba(56,189,248,0.5),transparent);
    }
    .mini-reactor { position:relative; width:52px; height:52px; flex-shrink:0; display:flex; align-items:center; justify-content:center; }
    .mr-ring1 { position:absolute; inset:0; border-radius:50%; border:1px solid rgba(56,189,248,0.2); animation:spin 8s linear infinite; }
    .mr-ring1::before { content:''; position:absolute; top:-2px; left:50%; transform:translateX(-50%); width:4px; height:4px; border-radius:50%; background:var(--blue); box-shadow:0 0 6px var(--blue); }
    .mr-ring2 { position:absolute; inset:7px; border-radius:50%; border:1px solid rgba(56,189,248,0.12); animation:spin 5s linear infinite reverse; }
    .mr-core { width:18px; height:18px; border-radius:50%; background:radial-gradient(circle,rgba(56,189,248,.9),rgba(56,189,248,.2) 60%,transparent); box-shadow:0 0 10px rgba(56,189,248,.7),0 0 20px rgba(56,189,248,.25); animation:corePulse 2.5s ease-in-out infinite; }

    .hud-info { flex:1; min-width:0; }
    .hud-name { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; color:var(--text); letter-spacing:.5px; }
    .hud-sub { font-family:'JetBrains Mono',monospace; font-size:9px; color:rgba(56,189,248,.45); letter-spacing:2px; margin-top:2px; }
    .hud-state { display:inline-flex; align-items:center; gap:5px; margin-top:7px; padding:4px 9px; border-radius:6px; font-family:'JetBrains Mono',monospace; font-size:10px; font-weight:700; letter-spacing:1.5px; transition:all .3s; }
    .hud-state.open  { background:rgba(63,185,80,.1); border:1px solid rgba(63,185,80,.25); color:var(--green); }
    .hud-state.closed{ background:rgba(248,81,73,.1); border:1px solid rgba(248,81,73,.25); color:var(--red); }
    .hud-state.moving{ background:rgba(240,136,62,.1); border:1px solid rgba(240,136,62,.25); color:var(--amber); }
    .hud-state.stopped{background:rgba(129,140,248,.1);border:1px solid rgba(129,140,248,.25);color:var(--purple);}
    .hud-state-dot { width:5px; height:5px; border-radius:50%; animation:sdot 1.5s infinite; }
    .open .hud-state-dot { background:var(--green); box-shadow:0 0 5px var(--green); }
    .closed .hud-state-dot { background:var(--red); box-shadow:0 0 5px var(--red); animation:none; }
    .moving .hud-state-dot { background:var(--amber); box-shadow:0 0 5px var(--amber); animation:sdot .5s infinite; }
    .stopped .hud-state-dot { background:var(--purple); box-shadow:0 0 5px var(--purple); animation:none; }

    .hud-metrics { display:flex; flex-direction:column; gap:6px; align-items:flex-end; }
    .hud-metric { display:flex; flex-direction:column; align-items:flex-end; gap:1px; }
    .hm-val { font-family:'JetBrains Mono',monospace; font-size:13px; font-weight:700; color:var(--text); line-height:1; }
    .hm-key { font-family:'JetBrains Mono',monospace; font-size:7px; color:rgba(56,189,248,.35); letter-spacing:1.5px; }
    .hud-online { position:absolute; top:12px; right:14px; display:flex; align-items:center; gap:4px; font-family:'JetBrains Mono',monospace; font-size:8px; color:var(--green); letter-spacing:1.5px; }
    .hon-dot { width:5px;height:5px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);animation:sdot 1.5s infinite; }

    .ctrl-wrap { margin:16px 20px 0; background:var(--surface); border:1px solid var(--border2); border-radius:32px; padding:28px 20px 36px; display:flex; flex-direction:column; align-items:center; position:relative; overflow:hidden; transition: background 1s ease; }
    .ctrl-wrap::before { content:''; position:absolute; top:0; left:60px; right:60px; height:1px; background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent); }
    .ctrl-wrap::after { content:''; position:absolute; bottom:0; left:60px; right:60px; height:1px; background:linear-gradient(90deg,transparent,rgba(255,255,255,.04),transparent); }
    .ctrl-label { font-family:'JetBrains Mono',monospace; font-size:8px; color:var(--text3); letter-spacing:3px; text-transform:uppercase; margin-bottom:28px; display:flex; align-items:center; gap:12px; width:100%; justify-content:center; }
    .ctrl-label::before,.ctrl-label::after { content:''; flex:1; max-width:40px; height:1px; background:var(--border); }
    .btn-col { display:flex; flex-direction:column; align-items:center; gap:0; }
    .btn-line { width:1px; height:20px; background:linear-gradient(180deg,var(--border2),rgba(255,255,255,.03)); position:relative; }
    .btn-line::before { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:5px; height:5px; border-radius:50%; background:rgba(255,255,255,.07); }
    .rbtn { position:relative; border:none; cursor:pointer; border-radius:50%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:6px; transition:transform .14s cubic-bezier(.4,0,.2,1); outline:none; -webkit-tap-highlight-color:transparent; }
    .rbtn:active { transform:scale(.91) !important; }
    .rbtn::before { content:''; position:absolute; top:7px; left:50%; transform:translateX(-50%); width:54%; height:32%; background:radial-gradient(ellipse,rgba(255,255,255,.09),transparent 70%); border-radius:50%; pointer-events:none; }
    .rbtn-up { width:96px; height:96px; background: radial-gradient(circle at 40% 35%, rgba(63,185,80,.24), rgba(63,185,80,.07) 55%, transparent 80%), radial-gradient(circle at 50% 50%, #1a2620, #111a14); border:1.5px solid rgba(63,185,80,.4); box-shadow: 0 0 0 6px rgba(63,185,80,.06), 0 0 0 12px rgba(63,185,80,.02), 0 14px 36px rgba(0,0,0,.65), inset 0 1px 0 rgba(63,185,80,.2), inset 0 -1px 0 rgba(0,0,0,.4); }
    .rbtn-up:active { box-shadow: 0 0 0 9px rgba(63,185,80,.14), 0 0 32px rgba(63,185,80,.4), 0 4px 12px rgba(0,0,0,.5) !important; }
    .rbtn-stop { width:112px; height:112px; background: radial-gradient(circle at 40% 35%, rgba(56,189,248,.2), rgba(56,189,248,.06) 55%, transparent 80%), radial-gradient(circle at 50% 50%, #131e2a, #0d1520); border:1.5px solid rgba(56,189,248,.32); box-shadow: 0 0 0 6px rgba(56,189,248,.05), 0 0 0 12px rgba(56,189,248,.02), 0 0 0 18px rgba(56,189,248,.008), 0 16px 40px rgba(0,0,0,.7), inset 0 1px 0 rgba(56,189,248,.15), inset 0 -1px 0 rgba(0,0,0,.5); }
    .rbtn-stop:active { box-shadow: 0 0 0 10px rgba(56,189,248,.15), 0 0 40px rgba(56,189,248,.45), 0 4px 12px rgba(0,0,0,.5) !important; }
    .rbtn-stop-ring { position:absolute; inset:5px; border-radius:50%; border-top:1px solid rgba(56,189,248,.3); border-right:1px solid transparent; border-bottom:1px solid transparent; border-left:1px solid rgba(56,189,248,.1); animation:spin 3s linear infinite; pointer-events:none; }
    .rbtn-down { width:96px; height:96px; background: radial-gradient(circle at 40% 35%, rgba(248,81,73,.22), rgba(248,81,73,.07) 55%, transparent 80%), radial-gradient(circle at 50% 50%, #241414, #180d0d); border:1.5px solid rgba(248,81,73,.38); box-shadow: 0 0 0 6px rgba(248,81,73,.06), 0 0 0 12px rgba(248,81,73,.02), 0 14px 36px rgba(0,0,0,.65), inset 0 1px 0 rgba(248,81,73,.18), inset 0 -1px 0 rgba(0,0,0,.4); }
    .rbtn-down:active { box-shadow: 0 0 0 9px rgba(248,81,73,.14), 0 0 32px rgba(248,81,73,.4), 0 4px 12px rgba(0,0,0,.5) !important; }
    .ico-up { width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-bottom:20px solid var(--green); filter:drop-shadow(0 0 6px rgba(63,185,80,.7)); transition:filter .14s; }
    .ico-down { width:0; height:0; border-left:15px solid transparent; border-right:15px solid transparent; border-top:20px solid var(--red); filter:drop-shadow(0 0 6px rgba(248,81,73,.7)); transition:filter .14s; }
    .ico-stop { display:flex; flex-direction:column; gap:8px; align-items:center; }
    .ico-stop span { display:block; width:30px; height:3px; border-radius:2px; background:var(--blue); box-shadow:0 0 8px rgba(56,189,248,.6); transition:box-shadow .14s; }
    .btn-lbl { font-family:'JetBrains Mono',monospace; font-size:8px; letter-spacing:2.5px; font-weight:700; opacity:.6; text-transform:uppercase; }
    .rbtn-up .btn-lbl { color:var(--green); }
    .rbtn-stop .btn-lbl { color:var(--blue); }
    .rbtn-down .btn-lbl { color:var(--red); }

    .pg-wrap { padding:18px 22px 0; }
    .pg-ey { font-size:10px;font-weight:500;color:var(--text3);letter-spacing:2px;text-transform:uppercase; }
    .pg-ttl { font-size:26px;font-weight:700;color:var(--text);margin-top:4px;letter-spacing:-.5px; }
    .pg-ttl span { color:var(--blue); }
    .sec-lbl { font-size:10px;font-weight:600;color:var(--text3); letter-spacing:2px;text-transform:uppercase; display:flex;align-items:center;gap:10px; margin:20px 0 10px; }
    .sec-lbl::after { content:'';flex:1;height:1px;background:var(--border); }

    .add-btn {
      width:100%; height:48px; margin:16px 0 0;
      background:rgba(56,189,248,.05);
      border:1px dashed rgba(56,189,248,.25);
      border-radius:14px;
      color:var(--blue); font-family:'Inter',sans-serif;
      font-size:13px; font-weight:600; letter-spacing:.3px;
      cursor:pointer; display:flex; align-items:center; justify-content:center; gap:8px;
      transition:all .18s;
    }
    .add-btn:hover { background:rgba(56,189,248,.09); border-color:rgba(56,189,248,.45); }
    .add-btn:active { transform:scale(.98); }

    .sch-row {
      background:var(--surface); border:1px solid var(--border);
      border-radius:14px; padding:14px; margin-bottom:8px;
      display:flex; align-items:center; gap:12px;
      position:relative; overflow:hidden; transition:border-color .18s;
    }
    .sch-row:hover { border-color:var(--border2); }
    .sch-row::after { content:''; position:absolute; left:0;top:0;bottom:0; width:2.5px; border-radius:2px 0 0 2px; }
    .sch-row.so::after { background:var(--green); box-shadow:2px 0 8px rgba(63,185,80,.4); }
    .sch-row.sc::after { background:var(--red);   box-shadow:2px 0 8px rgba(248,81,73,.4); }
    .sch-ico { width:40px;height:40px;border-radius:12px; display:flex;align-items:center;justify-content:center;flex-shrink:0; }
    .sch-ico.uo { background:rgba(63,185,80,.08);border:1px solid rgba(63,185,80,.15); }
    .sch-ico.uc { background:rgba(248,81,73,.08);border:1px solid rgba(248,81,73,.15); }
    .sau { width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent;border-bottom:10px solid var(--green); }
    .sad { width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent;border-top:10px solid var(--red); }
    .sch-info { flex:1; }
    .sch-t { font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:700;color:var(--text);line-height:1; }
    .sch-s { font-size:12px;color:var(--text2);margin-top:3px; }
    .sch-r { font-size:11px;font-weight:600;color:var(--blue);margin-top:2px; }
    .sch-badge { display:inline-flex;align-items:center;gap:3px;padding:2px 6px;border-radius:4px;font-family:'JetBrains Mono',monospace;font-size:8px;font-weight:700;letter-spacing:1px; margin-top:4px; }
    .sch-badge.open { background:rgba(63,185,80,.08);border:1px solid rgba(63,185,80,.18);color:var(--green); }
    .sch-badge.close { background:rgba(248,81,73,.08);border:1px solid rgba(248,81,73,.18);color:var(--red); }
    .sch-actions { display:flex;align-items:center;gap:8px; }
    .tog { width:46px;height:26px; background:var(--surface2); border:1px solid var(--border2); border-radius:13px; position:relative; cursor:pointer; flex-shrink:0; transition:all .22s; }
    .tog.on { background:rgba(63,185,80,.18); border-color:rgba(63,185,80,.38); }
    .tog::after { content:''; position:absolute; width:19px;height:19px;background:var(--text3); border-radius:50%;top:2.5px;left:4px; box-shadow:0 2px 6px rgba(0,0,0,.5); transition:all .22s; }
    .tog.on::after { left:22px; background:var(--green); box-shadow:0 0 10px rgba(63,185,80,.5); }
    .sch-del { width:28px;height:28px;border-radius:8px;border:1px solid rgba(248,81,73,.15);background:rgba(248,81,73,.06);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .18s;font-size:13px;color:var(--red); }
    .sch-del:hover { background:rgba(248,81,73,.12);border-color:rgba(248,81,73,.3); }

    .hflt { display:flex;gap:6px;margin:12px 0;overflow-x:auto;scrollbar-width:none; }
    .hflt::-webkit-scrollbar{display:none;}
    .hfc { flex-shrink:0;padding:5px 13px;border-radius:8px; font-size:12px;font-weight:600;cursor:pointer;transition:all .18s;border:1px solid transparent; }
    .hfc.on { background:rgba(56,189,248,.1);border-color:rgba(56,189,248,.3);color:var(--blue); }
    .hfc.off{ background:var(--surface);border-color:var(--border);color:var(--text2); }
    .dlbl { font-size:10px;font-weight:600;color:var(--text3);letter-spacing:2px;text-transform:uppercase; display:flex;align-items:center;gap:8px;margin:14px 0 8px; }
    .dlbl::after{content:'';flex:1;height:1px;background:var(--border);}
    .lrow { display:flex;align-items:center;gap:11px;padding:11px 0;border-bottom:1px solid var(--border);cursor:pointer;transition:all .18s; }
    .lrow:hover{background:rgba(255,255,255,.02);border-radius:8px;padding:11px 8px;}
    .lrow:last-child{border-bottom:none;}
    .lic { width:38px;height:38px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0; }
    .lic.o{background:rgba(63,185,80,.08);border:1px solid rgba(63,185,80,.14);}
    .lic.c{background:rgba(248,81,73,.08);border:1px solid rgba(248,81,73,.14);}
    .lic.w{background:rgba(240,136,62,.08);border:1px solid rgba(240,136,62,.18);}
    .lb { flex:1; }
    .la { font-size:13px;font-weight:600;color:var(--text); }
    .lm { font-size:11px;color:var(--text3);margin-top:1px; }
    .lt { display:flex;flex-direction:column;align-items:flex-end;gap:2px; }
    .lt-time { font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text2); }
    .lt-src { font-size:9px;font-weight:600;padding:1px 5px;border-radius:3px;letter-spacing:.5px; }
    .lt-src.app { background:rgba(56,189,248,.1);color:var(--blue); }
    .lt-src.auto { background:rgba(129,140,248,.1);color:var(--purple); }
    .lt-src.remote { background:rgba(63,185,80,.1);color:var(--green); }
    .lt-src.sensor { background:rgba(240,136,62,.1);color:var(--amber); }

    .pf-hero { background:var(--surface); border:1px solid var(--border); border-radius:18px; padding:18px; display:flex;align-items:center;gap:14px; margin-bottom:12px; position:relative;overflow:hidden; }
    .pf-hero::before { content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(56,189,248,.3),transparent); }
    .pf-av { width:60px;height:60px;border-radius:50%; background:linear-gradient(135deg,#4f8ef7,#7c3aed); display:flex;align-items:center;justify-content:center; font-size:20px;font-weight:700;color:#fff;flex-shrink:0; box-shadow:0 0 0 3px rgba(79,142,247,.2);position:relative; }
    .pf-av-dot{position:absolute;bottom:1px;right:1px;width:14px;height:14px;border-radius:50%;background:var(--green);border:2.5px solid var(--surface);box-shadow:0 0 8px var(--green);}
    .pf-nm{font-size:17px;font-weight:700;color:var(--text);}
    .pf-em{font-size:11px;color:var(--text2);margin-top:2px;}
    .pf-rl{display:inline-flex;align-items:center;background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.18);border-radius:5px;padding:3px 8px;font-size:9px;font-weight:600;color:var(--blue);letter-spacing:.5px;margin-top:7px;}

    .db-card { background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:8px; }
    .db-card-ttl { font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px;display:flex;align-items:center;gap:8px; }
    .db-card-ttl::after{content:'';flex:1;height:1px;background:var(--border);}
    .db-row { display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.03); }
    .db-row:last-child{border-bottom:none;}
    .db-k { font-size:12px;color:var(--text2);font-weight:500; }
    .db-v { font-family:'JetBrains Mono',monospace;font-size:12px;color:var(--text);font-weight:600; }
    .db-v.ok { color:var(--green); }
    .pf-sts{display:flex;gap:1px;background:var(--border);border-radius:12px;overflow:hidden;margin-bottom:12px;}
    .pfs{flex:1;background:var(--surface);padding:13px 8px;text-align:center;}
    .pfv{font-family:'JetBrains Mono',monospace;font-size:18px;font-weight:700;color:var(--text);}
    .pfl{font-size:10px;color:var(--text3);margin-top:2px;font-weight:500;}
    .pf-menu{display:flex;flex-direction:column;gap:7px;}
    .pfr{background:var(--surface);border:1px solid var(--border);border-radius:13px;padding:13px 14px;display:flex;align-items:center;gap:11px;cursor:pointer;transition:all .18s;position:relative;overflow:hidden;}
    .pfr::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--blue);opacity:0;transition:opacity .18s;}
    .pfr:hover{border-color:var(--border2);}
    .pfr:hover::before{opacity:1;}
    .pfr:active{transform:scale(.99);}
    .pfi{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;}
    .pfli{flex:1;}
    .pfll{font-size:13px;font-weight:600;color:var(--text);}
    .pfls{font-size:10px;color:var(--text3);margin-top:1px;}
    .pfar{color:var(--text3);font-size:16px;}

    .nav-overlay { position:absolute;inset:0; background:rgba(8,11,16,0.72); backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px); z-index:900; opacity:0; pointer-events:none; transition:opacity .22s; }
    .nav-overlay.open{opacity:1;pointer-events:all;}
    .nav-popup { position:absolute; bottom:102px; left:50%; transform:translateX(-50%) translateY(14px) scale(.94); opacity:0; pointer-events:none; z-index:950; width:276px; transition:all .3s cubic-bezier(.34,1.5,.64,1); }
    .nav-popup.open { opacity:1; transform:translateX(-50%) translateY(0) scale(1); pointer-events:all; }
    .nav-inner { background:rgba(18,22,30,0.97); border:1px solid rgba(255,255,255,.1); border-radius:24px; padding:7px; box-shadow: 0 0 0 1px rgba(255,255,255,.03), 0 28px 64px rgba(0,0,0,.75), 0 8px 20px rgba(0,0,0,.5); }
    .nav-handle{width:34px;height:3px;background:rgba(255,255,255,.1);border-radius:2px;margin:3px auto 11px;}
    .nav-grid{display:flex;gap:5px;padding:0 2px 5px;}
    .nitem { flex:1; padding:13px 5px 11px; border-radius:17px; border:1px solid transparent; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:7px; background:transparent; transition:all .18s; }
    .nitem:hover{background:rgba(255,255,255,.04);}
    .nitem:active{transform:scale(.93);}
    .nitem.na { background:rgba(56,189,248,.08); border-color:rgba(56,189,248,.18); }
    .nico { width:46px;height:46px;border-radius:50%; display:flex;align-items:center;justify-content:center;font-size:20px; border:1px solid var(--border);background:var(--surface); transition:all .18s; position:relative; }
    .nitem.na .nico { border-color:rgba(56,189,248,.28); background:rgba(56,189,248,.06); box-shadow:0 0 14px rgba(56,189,248,.12); }
    .nitem:hover .nico { border-color:var(--border2); }
    .nadot { position:absolute; bottom:-2px; left:50%; transform:translateX(-50%); width:4px;height:4px;border-radius:50%; background:var(--blue);box-shadow:0 0 7px var(--blue);display:none; }
    .nitem.na .nadot{display:block;}
    .nlbl{font-size:10px;font-weight:600;color:var(--text2);letter-spacing:.3px;transition:color .18s;}
    .nitem.na .nlbl{color:var(--blue);}
    .nitem:hover .nlbl{color:var(--text);}

    .fab-wrap { position:absolute; bottom:26px; left:50%; transform:translateX(-50%); z-index:960; display:flex; flex-direction:column; align-items:center; gap:9px; }
    .pdots{display:flex;gap:5px;align-items:center;}
    .pd{width:4px;height:4px;border-radius:2px;background:var(--text3);transition:all .3s cubic-bezier(.4,0,.2,1);}
    .pd.on{background:var(--blue);width:14px;box-shadow:0 0 7px var(--blue);}
    .fab { width:58px;height:58px;border-radius:50%;border:none;cursor:pointer; background:linear-gradient(145deg,#4f8ef7,#3a6fd4); box-shadow: 0 0 0 5px rgba(79,142,247,.1), 0 0 0 10px rgba(79,142,247,.04), 0 0 22px rgba(79,142,247,.3), 0 8px 22px rgba(0,0,0,.6); display:flex;align-items:center;justify-content:center; transition:all .28s cubic-bezier(.34,1.4,.64,1); position:relative; overflow:hidden; }
    .fab::before{content:'';position:absolute;top:-1px;left:0;right:0;height:45%;background:linear-gradient(180deg,rgba(255,255,255,.14),transparent);border-radius:50% 50% 0 0/60% 60% 0 0;}
    .fab.open{ background:linear-gradient(145deg,#f85149,#c0392b); box-shadow:0 0 0 5px rgba(248,81,73,.1),0 0 0 10px rgba(248,81,73,.04),0 0 22px rgba(248,81,73,.3),0 8px 22px rgba(0,0,0,.6); transform:rotate(45deg); }
    .fab:active{transform:scale(.9);}
    .fab.open:active{transform:rotate(45deg) scale(.9);}
    .fico{font-size:22px;pointer-events:none;line-height:1;}
    .fring{position:absolute;inset:-5px;border-radius:50%;border:1px solid rgba(79,142,247,.18);animation:fping 3s ease-out infinite;}
    .fring2{position:absolute;inset:-12px;border-radius:50%;border:1px solid rgba(79,142,247,.08);animation:fping 3s ease-out infinite .7s;}
    @keyframes fping{0%{transform:scale(.95);opacity:.7}70%{transform:scale(1.18);opacity:0}100%{opacity:0}}

    .modal-overlay {
      position:absolute;inset:0;
      background:rgba(8,11,16,0.85);
      backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);
      z-index:1000; opacity:0; pointer-events:none;
      transition:opacity .3s;
      display:flex; align-items:flex-end;
    }
    .modal-overlay.show { opacity:1; pointer-events:all; }
    .modal-sheet {
      width:100%;
      background:var(--surface);
      border:1px solid var(--border2);
      border-bottom:none;
      border-radius:28px 28px 0 0;
      padding:0 20px 36px;
      transform:translateY(100%);
      transition:transform .4s cubic-bezier(.32,0,.15,1);
      position:relative;
      overflow:hidden;
      max-height:88%;
      overflow-y:auto;
      scrollbar-width:none;
    }
    .modal-sheet::-webkit-scrollbar{display:none;}
    .modal-sheet::before { content:''; position:absolute; top:0; left:30px; right:30px; height:1px; background:linear-gradient(90deg,transparent,rgba(56,189,248,.4),transparent); }
    .modal-overlay.show .modal-sheet { transform:translateY(0); }
    .modal-handle { width:36px;height:4px;background:rgba(255,255,255,.1);border-radius:2px;margin:14px auto 20px; }
    .modal-ttl { font-size:18px;font-weight:700;color:var(--text);letter-spacing:-.3px;margin-bottom:4px; }
    .modal-sub { font-size:12px;color:var(--text3);margin-bottom:22px; }

    .f-group { margin-bottom:16px; }
    .f-label { font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:700;color:var(--text3);letter-spacing:2px;text-transform:uppercase;margin-bottom:7px;display:block; }
    .f-input {
      width:100%; background:var(--bg);
      border:1px solid var(--border2);
      border-radius:12px; padding:13px 14px;
      color:var(--text); font-family:'JetBrains Mono',monospace;
      font-size:15px; font-weight:600;
      outline:none; transition:border-color .18s, box-shadow .18s;
      -webkit-appearance:none; appearance:none;
    }
    .f-input:focus { border-color:rgba(56,189,248,.5); box-shadow:0 0 0 3px rgba(56,189,248,.08); }
    .f-input[type="time"] { color-scheme:dark; }
    .f-select { background-image:url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%237d8590' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat:no-repeat; background-position:right 14px center; padding-right:38px; cursor:pointer; }

    .action-row { display:flex;gap:8px; }
    .act-opt {
      flex:1;padding:11px 8px;border-radius:12px;
      border:1px solid var(--border2);
      background:var(--bg);
      cursor:pointer; text-align:center;
      transition:all .18s;
      position:relative; overflow:hidden;
    }
    .act-opt::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; opacity:0; transition:opacity .18s; }
    .act-opt.sel-open { border-color:rgba(63,185,80,.4);background:rgba(63,185,80,.06); }
    .act-opt.sel-open::before { background:linear-gradient(90deg,transparent,rgba(63,185,80,.6),transparent);opacity:1; }
    .act-opt.sel-close { border-color:rgba(248,81,73,.4);background:rgba(248,81,73,.06); }
    .act-opt.sel-close::before { background:linear-gradient(90deg,transparent,rgba(248,81,73,.6),transparent);opacity:1; }
    .act-ico { font-size:20px;margin-bottom:5px; }
    .act-lbl { font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;letter-spacing:1px; }
    .act-opt.sel-open .act-lbl { color:var(--green); }
    .act-opt.sel-close .act-lbl { color:var(--red); }
    .act-opt:not(.sel-open):not(.sel-close) .act-lbl { color:var(--text3); }

    .days-row { display:flex;gap:5px; }
    .day-cb { flex:1;aspect-ratio:1; border-radius:10px;border:1px solid var(--border2);background:var(--bg); display:flex;align-items:center;justify-content:center; cursor:pointer;transition:all .18s; font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;color:var(--text3); }
    .day-cb.on { background:rgba(56,189,248,.1);border-color:rgba(56,189,248,.35);color:var(--blue);box-shadow:0 0 10px rgba(56,189,248,.1); }

    .f-btn {
      width:100%;height:52px;border:none;border-radius:16px;
      background:linear-gradient(135deg,#4f8ef7,#3a6fd4);
      color:#fff;font-size:15px;font-weight:700;
      cursor:pointer;transition:all .18s;
      box-shadow:0 4px 20px rgba(79,142,247,.3);
      position:relative;overflow:hidden;
      margin-top:8px;
    }
    .f-btn::before { content:'';position:absolute;top:0;left:0;right:0;height:50%;background:linear-gradient(180deg,rgba(255,255,255,.12),transparent); }
    .f-btn:active { transform:scale(.98); }
    .f-btn-cancel { width:100%;height:44px;border:1px solid var(--border2);border-radius:14px; background:transparent;color:var(--text2);font-size:14px;font-weight:600; cursor:pointer;transition:all .18s;margin-top:8px; }
    .f-btn-cancel:active{transform:scale(.98);}

    .repeat-preview { font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--blue);margin-top:6px;min-height:16px;letter-spacing:.5px; }

    .f-div { height:1px;background:var(--border);margin:16px 0; }

    .f-toggle-row { display:flex;align-items:center;justify-content:space-between;padding:11px 14px;background:var(--bg);border:1px solid var(--border2);border-radius:12px; }
    .f-toggle-title { font-size:13px;font-weight:600;color:var(--text); }
    .f-toggle-sub { font-size:11px;color:var(--text3);margin-top:1px; }

    .loading-spinner { display:inline-block; width:16px; height:16px; border:2px solid rgba(255,255,255,.3); border-top-color:#fff; border-radius:50%; animation:spin .8s linear infinite; }
  </style>
</head>
<body>
<div class="phone">
  <div class="island"><div class="island-mic"></div><div class="island-cam"></div><div class="island-mic"></div></div>

  <div class="sb">
    <span class="sb-t" id="clk">09:41</span>
    <div class="sb-r">
      <div class="sb-bars">
        <div class="sb-b" style="height:5px"></div>
        <div class="sb-b" style="height:8px"></div>
        <div class="sb-b" style="height:11px"></div>
        <div class="sb-b" style="height:11px;opacity:.2"></div>
      </div>
      <div class="sb-bat"><div class="sb-bf"></div></div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê LOGIN PAGE ‚ïê‚ïê‚ïê -->
  <div id="loginPage">
    <div class="logo-block">
      <div class="reactor">
        <div class="r-pulse"></div>
        <div class="r-pulse2"></div>
        <div class="r-ring1"></div>
        <div class="r-ring2"></div>
        <div class="r-ring3"></div>
        <div class="r-core"></div>
      </div>
      <div class="brand-name">Smart<span>Door</span></div>
      <div class="brand-tag">H·ªá Th·ªëng ƒêi·ªÅu Khi·ªÉn C·ª≠a</div>
    </div>

    <div class="form-card">
      <div class="form-ttl">ƒêƒÉng nh·∫≠p h·ªá th·ªëng</div>

      <div class="err-msg" id="errMsg">
        <span class="err-ico">‚ö†</span>
        <span id="errTxt">Email ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng</span>
      </div>

      <div class="inp-wrap">
        <span class="inp-icon">‚úâ</span>
        <input class="f-inp" type="email" id="f-email" placeholder="Email c·ªßa b·∫°n" autocomplete="email">
      </div>

      <div class="inp-wrap">
        <span class="inp-icon">üîë</span>
        <input class="f-inp" type="password" id="f-pass" placeholder="M·∫≠t kh·∫©u" autocomplete="current-password">
        <button class="eye-btn" id="eyeBtn" onclick="togglePass()" tabindex="-1">üëÅ</button>
      </div>

      <div class="meta-row">
        <div class="rem-wrap" onclick="toggleRemember()">
          <div class="rem-box on" id="remBox"></div>
          <span class="rem-lbl">Ghi nh·ªõ ƒëƒÉng nh·∫≠p</span>
        </div>
        <span class="forgot">Qu√™n m·∫≠t kh·∫©u?</span>
      </div>

      <button class="login-btn" id="loginBtn" onclick="doLogin()">
        <span class="btn-txt">ƒêƒÇNG NH·∫¨P</span>
        <div class="btn-spin"><div class="spin-ring"></div></div>
      </button>

      <div class="sys-bar">
        <div class="sys-dot"><div class="sd ok"></div>SERVER</div>
        <div class="sys-dot"><div class="sd ok"></div>API</div>
        <div class="sys-dot"><div class="sd ok"></div>DEVICE</div>
      </div>
    </div>

    <div class="bottom-links">
      Ch∆∞a c√≥ t√†i kho·∫£n? <a onclick="alert('Li√™n h·ªá Admin ƒë·ªÉ t·∫°o t√†i kho·∫£n')">Li√™n h·ªá Admin</a>
    </div>

    <div class="success-overlay" id="sucOverlay">
      <div class="suc-ring"><span class="suc-check">‚úì</span></div>
      <div class="suc-txt">X√ÅC TH·ª∞C TH√ÄNH C√îNG</div>
      <div class="suc-sub">ƒêang chuy·ªÉn h∆∞·ªõng‚Ä¶</div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê MAIN APP PAGE ‚ïê‚ïê‚ïê -->
  <div id="appPage">
    <div class="pages">
      <!-- HOME PAGE -->
      <div class="page active" id="page-home">
        <div class="hud-header">
          <div class="hud-online"><div class="hon-dot"></div>ONLINE</div>
          <div class="mini-reactor">
            <div class="mr-ring1"></div>
            <div class="mr-ring2"></div>
            <div class="mr-core"></div>
          </div>
          <div class="hud-info">
            <div class="hud-name" id="hudName">GARAGE ¬∑ A1</div>
            <div class="hud-sub">VER 2.4 ¬∑ SYS OK</div>
            <div class="hud-state open" id="hudState">
              <div class="hud-state-dot"></div>
              <span id="hudStateText">ƒêANG M·ªû</span>
            </div>
          </div>
          <div class="hud-metrics">
            <div class="hud-metric">
              <div class="hm-val" id="logCount">0</div>
              <div class="hm-key">L∆Ø·ª¢T</div>
            </div>
            <div class="hud-metric">
              <div class="hm-val">24¬∞</div>
              <div class="hm-key">NHI·ªÜT</div>
            </div>
          </div>
        </div>
        <div class="ctrl-wrap">
          <div class="ctrl-label">ƒêi·ªÅu khi·ªÉn c·ª≠a</div>
          <div class="btn-col">
            <button class="rbtn rbtn-up" onclick="doDoor('OPEN')" id="btnOpen">
              <div class="ico-up"></div>
              <span class="btn-lbl">M·ªü</span>
            </button>
            <div class="btn-line"></div>
            <button class="rbtn rbtn-stop" onclick="doDoor('STOP')" id="btnStop">
              <div class="rbtn-stop-ring"></div>
              <div class="ico-stop"><span></span><span></span></div>
              <span class="btn-lbl">D·ª´ng</span>
            </button>
            <div class="btn-line"></div>
            <button class="rbtn rbtn-down" onclick="doDoor('CLOSE')" id="btnClose">
              <div class="ico-down"></div>
              <span class="btn-lbl">ƒê√≥ng</span>
            </button>
          </div>
        </div>
      </div>

      <!-- SCHEDULE PAGE -->
      <div class="page" id="page-schedule">
        <div class="pg-wrap">
          <div class="pg-ey">T·ª± ƒë·ªông h√≥a</div>
          <div class="pg-ttl">H·∫πn <span>gi·ªù</span></div>
          <button class="add-btn" onclick="openAddSchedule()">
            <span style="font-size:18px;font-weight:300;line-height:1">+</span> Th√™m l·ªãch h·∫πn gi·ªù
          </button>

          <div class="sec-lbl">ƒêang b·∫≠t</div>
          <div id="scheduleActiveList"></div>

          <div class="sec-lbl">ƒê√£ t·∫Øt</div>
          <div id="scheduleInactiveList"></div>
        </div>
      </div>

      <!-- HISTORY PAGE -->
      <div class="page" id="page-history">
        <div class="pg-wrap">
          <div class="pg-ey">Nh·∫≠t k√Ω ho·∫°t ƒë·ªông</div>
          <div class="pg-ttl">L·ªãch <span style="color:var(--purple)">s·ª≠</span></div>
          <div class="hflt">
            <div class="hfc on" onclick="filterLog(this,'all')">T·∫•t c·∫£</div>
            <div class="hfc off" onclick="filterLog(this,'OPEN')">M·ªü c·ª≠a</div>
            <div class="hfc off" onclick="filterLog(this,'CLOSE')">ƒê√≥ng c·ª≠a</div>
            <div class="hfc off" onclick="filterLog(this,'STOP')">D·ª´ng</div>
          </div>
          <div id="historyList"></div>
        </div>
      </div>

      <!-- PROFILE PAGE -->
      <div class="page" id="page-profile">
        <div class="pg-wrap">
          <div class="pg-ey">T√†i kho·∫£n</div>
          <div class="pg-ttl" style="margin-bottom:14px">H·ªì <span>s∆°</span></div>

          <div class="pf-hero">
            <div class="pf-av" id="userAvatar">NM<div class="pf-av-dot"></div></div>
            <div>
              <div class="pf-nm" id="userName">Nguy·ªÖn Minh</div>
              <div class="pf-em" id="userEmail">nguyen.minh@email.com</div>
              <div style="display:flex;gap:5px;flex-wrap:wrap;margin-top:7px;">
                <div class="pf-rl">Admin ¬∑ C·∫•p 3</div>
                <div class="pf-rl" style="border-color:rgba(63,185,80,.25);color:var(--green);background:rgba(63,185,80,.06);">‚óè Online</div>
              </div>
            </div>
          </div>

          <div class="pf-sts">
            <div class="pfs"><div class="pfv" id="statActions">0</div><div class="pfl">T·ªïng l∆∞·ª£t</div></div>
            <div class="pfs"><div class="pfv" id="statDevices">0</div><div class="pfl">Thi·∫øt b·ªã</div></div>
            <div class="pfs"><div class="pfv" id="statSchedules">0</div><div class="pfl">H·∫πn gi·ªù</div></div>
            <div class="pfs"><div class="pfv" id="statDays">0</div><div class="pfl">Ng√†y d√πng</div></div>
          </div>

          <div class="db-card">
            <div class="db-card-ttl">Th√¥ng tin h·ªá th·ªëng</div>
            <div class="db-row">
              <span class="db-k">Tr·∫°ng th√°i</span>
              <span class="db-v ok">‚óè Online</span>
            </div>
            <div class="db-row">
              <span class="db-k">Phi√™n b·∫£n</span>
              <span class="db-v">v2.4.1</span>
            </div>
          </div>

          <div class="pf-menu" style="margin-bottom:0">
            <div class="pfr"><div class="pfi" style="background:rgba(56,189,248,.08)">üîî</div><div class="pfli"><div class="pfll">Th√¥ng b√°o Push</div><div class="pfls">C·∫£nh b√°o & nh·∫Øc nh·ªü</div></div><div class="tog on" onclick="this.classList.toggle('on')"></div></div>
            <div class="pfr"><div class="pfi" style="background:rgba(63,185,80,.08)">üîí</div><div class="pfli"><div class="pfll">B·∫£o m·∫≠t</div><div class="pfls">V√¢n tay, Face ID, PIN</div></div><div class="pfar">‚Ä∫</div></div>
            <div class="pfr" onclick="doLogout()"><div class="pfi" style="background:rgba(248,81,73,.08)">üö™</div><div class="pfli"><div class="pfll" style="color:var(--red)">ƒêƒÉng xu·∫•t</div><div class="pfls">Tho√°t t√†i kho·∫£n</div></div><div class="pfar" style="color:var(--red)">‚Ä∫</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Nav overlay -->
    <div class="nav-overlay" id="navOv" onclick="closeNav()"></div>

    <!-- Nav popup -->
    <div class="nav-popup" id="navPop">
      <div class="nav-inner">
        <div class="nav-handle"></div>
        <div class="nav-grid">
          <div class="nitem na" data-p="home" onclick="goTo('home')">
            <div class="nico">üè†<div class="nadot"></div></div>
            <span class="nlbl">Trang ch·ªß</span>
          </div>
          <div class="nitem" data-p="schedule" onclick="goTo('schedule')">
            <div class="nico">‚è±<div class="nadot"></div></div>
            <span class="nlbl">H·∫πn gi·ªù</span>
          </div>
          <div class="nitem" data-p="history" onclick="goTo('history')">
            <div class="nico">üìã<div class="nadot"></div></div>
            <span class="nlbl">L·ªãch s·ª≠</span>
          </div>
          <div class="nitem" data-p="profile" onclick="goTo('profile')">
            <div class="nico">üë§<div class="nadot"></div></div>
            <span class="nlbl">H·ªì s∆°</span>
          </div>
        </div>
      </div>
    </div>

    <!-- FAB -->
    <div class="fab-wrap">
      <div class="pdots">
        <div class="pd on" id="pd-home"></div>
        <div class="pd" id="pd-schedule"></div>
        <div class="pd" id="pd-history"></div>
        <div class="pd" id="pd-profile"></div>
      </div>
      <button class="fab" id="fab" onclick="toggleNav()">
        <div class="fring"></div><div class="fring2"></div>
        <span class="fico" id="fico">‚äπ</span>
      </button>
    </div>

    <!-- ADD SCHEDULE MODAL -->
    <div class="modal-overlay" id="addModal" onclick="handleModalClick(event)">
      <div class="modal-sheet" id="addSheet">
        <div class="modal-handle"></div>
        <div class="modal-ttl">Th√™m h·∫πn gi·ªù</div>
        <div class="modal-sub">T·ª± ƒë·ªông ƒëi·ªÅu khi·ªÉn c·ª≠a theo l·ªãch</div>

        <div class="f-group">
          <label class="f-label">Thi·∫øt b·ªã</label>
          <select class="f-input f-select" id="f-device">
            <option value="d01">C·ª≠a garage A1</option>
            <option value="d02">C·ª≠a ph·ª• B1</option>
            <option value="d03">C·ªïng ch√≠nh C1</option>
          </select>
        </div>

        <div class="f-group">
          <label class="f-label">H√†nh ƒë·ªông</label>
          <div class="action-row">
            <div class="act-opt sel-open" id="actOpen" onclick="selectAction('OPEN')">
              <div class="act-ico">üîì</div>
              <div class="act-lbl">M·ªû C·ª¨A</div>
            </div>
            <div class="act-opt" id="actClose" onclick="selectAction('CLOSE')">
              <div class="act-ico">üîí</div>
              <div class="act-lbl">ƒê√ìNG C·ª¨A</div>
            </div>
          </div>
        </div>

        <div class="f-group">
          <label class="f-label">Th·ªùi gian th·ª±c hi·ªán</label>
          <input type="time" class="f-input" id="f-time" value="07:00">
        </div>

        <div class="f-group">
          <label class="f-label">L·∫∑p l·∫°i v√†o</label>
          <div class="days-row" id="daysRow">
            <div class="day-cb" data-d="1" onclick="toggleDay(this)">T2</div>
            <div class="day-cb" data-d="2" onclick="toggleDay(this)">T3</div>
            <div class="day-cb" data-d="3" onclick="toggleDay(this)">T4</div>
            <div class="day-cb" data-d="4" onclick="toggleDay(this)">T5</div>
            <div class="day-cb" data-d="5" onclick="toggleDay(this)">T6</div>
            <div class="day-cb" data-d="6" onclick="toggleDay(this)">T7</div>
            <div class="day-cb" data-d="0" onclick="toggleDay(this)">CN</div>
          </div>
          <div class="repeat-preview" id="repeatPreview">Ch∆∞a ch·ªçn ng√†y</div>
        </div>

        <div class="f-div"></div>

        <div class="f-group">
          <label class="f-label">Tr·∫°ng th√°i</label>
          <div class="f-toggle-row">
            <div class="f-toggle-info">
              <div class="f-toggle-title">K√≠ch ho·∫°t ngay</div>
              <div class="f-toggle-sub">L·ªãch s·∫Ω ch·∫°y ngay sau khi l∆∞u</div>
            </div>
            <div class="tog on" id="fTogActive" onclick="this.classList.toggle('on')"></div>
          </div>
        </div>

        <div class="f-group">
          <label class="f-label">Th√¥ng b√°o</label>
          <div class="f-toggle-row">
            <div class="f-toggle-info">
              <div class="f-toggle-title">G·ª≠i th√¥ng b√°o</div>
              <div class="f-toggle-sub">Nh·∫≠n push khi l·ªãch ch·∫°y</div>
            </div>
            <div class="tog on" id="fTogNotify" onclick="this.classList.toggle('on')"></div>
          </div>
        </div>

        <button class="f-btn" onclick="saveSchedule()">üíæ L∆∞u h·∫πn gi·ªù</button>
        <button class="f-btn-cancel" onclick="closeAddSchedule()">H·ªßy</button>
      </div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// API CONFIGURATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const API_BASE = "https://nguyenthanhvan.software/rolldingdoor/api";
let authToken = localStorage.getItem('authToken') || null;
let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tick(){
  const n = new Date();
  document.getElementById('clk').textContent = String(n.getHours()).padStart(2,'0') + ':' + String(n.getMinutes()).padStart(2,'0');
}
tick();
setInterval(tick, 15000);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGIN FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function togglePass(){
  const inp = document.getElementById('f-pass');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

function toggleRemember(){
  document.getElementById('remBox').classList.toggle('on');
}

function showError(msg){
  const err = document.getElementById('errMsg');
  document.getElementById('errTxt').textContent = msg;
  err.classList.add('show');
}

async function doLogin(){
  const username = document.getElementById('f-email').value.trim();
  const pass = document.getElementById('f-pass').value;
  const btn = document.getElementById('loginBtn');
  const err = document.getElementById('errMsg');

  err.classList.remove('show');

  if(!username || !pass){
    showError('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin');
    return;
  }

  btn.classList.add('loading');

  try {
    const response = await fetch(`${API_BASE}/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password: pass })
    });

    const data = await response.json();
    
    if(response.ok && data.token){
      authToken = data.token;
      currentUser = { username: data.username, role: data.role };
      localStorage.setItem('authToken', authToken);
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      
      document.getElementById('sucOverlay').classList.add('show');
      setTimeout(() => {
        showAppPage();
        loadUserData();
      }, 1500);
    } else {
      btn.classList.remove('loading');
      showError(data.message || 'T√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng');
      document.querySelector('.form-card').style.animation = 'none';
      document.querySelector('.form-card').offsetHeight;
      document.querySelector('.form-card').style.animation = 'shake .4s';
    }
  } catch(error){
    btn.classList.remove('loading');
    showError('L·ªói k·∫øt n·ªëi: ' + error.message);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE MANAGEMENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showAppPage(){
  document.getElementById('loginPage').style.display = 'none';
  document.getElementById('appPage').style.display = 'flex';
}

function showLoginPage(){
  document.getElementById('appPage').style.display = 'none';
  document.getElementById('loginPage').style.display = 'flex';
  document.getElementById('sucOverlay').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DOOR CONTROL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let doorTimeout = null;
const doorStates = {
  OPEN: { text: 'ƒêANG M·ªû', cls: 'open' },
  CLOSED: { text: 'ƒê√É ƒê√ìNG', cls: 'closed' },
  MOVING: { text: 'ƒêANG CH·∫†Y', cls: 'moving' },
  STOP: { text: 'D·ª™NG', cls: 'stopped' },
};

function setState(k){
  const s = doorStates[k] || doorStates.MOVING;
  document.getElementById('hudState').className = 'hud-state ' + s.cls;
  document.getElementById('hudStateText').textContent = s.text;
}

async function doDoor(action){
  if(!authToken) {
    showLoginPage();
    return;
  }

  clearTimeout(doorTimeout);
  setState('MOVING');
  
  const buttons = document.getElementById('btnOpen').parentElement.querySelectorAll('button');
  buttons.forEach(b => b.disabled = true);

  try {
    const response = await fetch(`${API_BASE}/command`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      },
      body: JSON.stringify({ action })
    });

    const data = await response.json();

    if(response.ok){
      doorTimeout = setTimeout(() => {
        if(action === 'OPEN') setState('OPEN');
        else if(action === 'CLOSE') setState('CLOSED');
        else setState('STOP');
        buttons.forEach(b => b.disabled = false);
      }, Math.random() * 600 + 900);
    } else {
      setState('CLOSED');
      buttons.forEach(b => b.disabled = false);
    }
  } catch(error){
    console.error('Error:', error);
    setState('CLOSED');
    buttons.forEach(b => b.disabled = false);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let navOpen = false, curPage = 'home';

function toggleNav(){
  navOpen = !navOpen;
  document.getElementById('navOv').classList.toggle('open', navOpen);
  document.getElementById('navPop').classList.toggle('open', navOpen);
  document.getElementById('fab').classList.toggle('open', navOpen);
  document.getElementById('fico').textContent = navOpen ? '‚úï' : '‚äπ';
}

function closeNav(){
  if(navOpen) toggleNav();
}

function goTo(p){
  if(p === curPage) { closeNav(); return; }
  document.getElementById('page-' + curPage).classList.remove('active');
  document.getElementById('page-' + p).classList.add('active');
  document.getElementById('pd-' + curPage).classList.remove('on');
  document.getElementById('pd-' + p).classList.add('on');
  document.querySelectorAll('.nitem').forEach(e => e.classList.toggle('na', e.dataset.p === p));
  curPage = p;
  setTimeout(closeNav, 180);
  
  // Load data for page
  if(p === 'schedule') loadSchedules();
  else if(p === 'history') loadLogs();
  else if(p === 'profile') loadUserStats();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// USER DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadUserData(){
  if(!currentUser) return;
  const initials = (currentUser.username || 'U').substring(0, 2).toUpperCase();
  document.getElementById('userAvatar').textContent = initials;
  document.getElementById('userName').textContent = currentUser.username || 'User';
  document.getElementById('userEmail').textContent = currentUser.role === 'admin' ? 'Qu·∫£n tr·ªã vi√™n' : 'Ng∆∞·ªùi d√πng';
  loadUserStats();
  loadLogs();
}

async function loadUserStats(){
  if(!authToken) return;
  try {
    const [logsRes, schedulesRes] = await Promise.all([
      fetch(`${API_BASE}/logs`, { headers: { 'Authorization': `Bearer ${authToken}` } }),
      fetch(`${API_BASE}/schedules`, { headers: { 'Authorization': `Bearer ${authToken}` } })
    ]);

    if(logsRes.ok && schedulesRes.ok){
      const logsData = await logsRes.json();
      const schedulesData = await schedulesRes.json();
      
      const logs = Array.isArray(logsData) ? logsData : (logsData.logs || []);
      const schedules = Array.isArray(schedulesData) ? schedulesData : (schedulesData.schedules || []);
      
      document.getElementById('statActions').textContent = logs.length;
      document.getElementById('statSchedules').textContent = schedules.length;
      document.getElementById('statDevices').textContent = '1';
      document.getElementById('statDays').textContent = '7';
      document.getElementById('logCount').textContent = logs.length;
    }
  } catch(error){
    console.error('Error loading stats:', error);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGS / HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadLogs(){
  if(!authToken) return;
  
  try {
    const response = await fetch(`${API_BASE}/logs`, {
      headers: { 'Authorization': `Bearer ${authToken}` }
    });

    if(response.ok){
      const data = await response.json();
      const logs = Array.isArray(data) ? data : (data.logs || []);
      displayLogs(logs);
    }
  } catch(error){
    console.error('Error loading logs:', error);
  }
}

function displayLogs(logs){
  const container = document.getElementById('historyList');
  container.innerHTML = '';

  if(logs.length === 0){
    container.innerHTML = '<div style="padding:20px;text-align:center;color:var(--text3);">Ch∆∞a c√≥ ho·∫°t ƒë·ªông</div>';
    return;
  }

  const grouped = {};
  logs.forEach(log => {
    const date = new Date(log.createdAt).toLocaleDateString('vi-VN');
    if(!grouped[date]) grouped[date] = [];
    grouped[date].push(log);
  });

  Object.keys(grouped).reverse().forEach(date => {
    const content = `<div class="dlbl">${date}</div>`;
    container.insertAdjacentHTML('beforeend', content);

    grouped[date].forEach(log => {
      const time = new Date(log.createdAt).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
      const iconMap = { OPEN: 'üîì', CLOSE: 'üîí', STOP: '‚èπ' };
      const typeClass = log.action === 'OPEN' ? 'o' : (log.action === 'CLOSE' ? 'c' : 'w');
      const actionMap = { OPEN: 'M·ªü c·ª≠a', CLOSE: 'ƒê√≥ng c·ª≠a', STOP: 'D·ª´ng' };
      
      const row = `
        <div class="lrow" data-type="${log.action}">
          <div class="lic ${typeClass}">${iconMap[log.action] || '‚öô'}</div>
          <div class="lb">
            <div class="la">${actionMap[log.action] || log.action}</div>
            <div class="lm">C·ª≠a garage A1 ¬∑ 1.2s</div>
          </div>
          <div class="lt">
            <span class="lt-time">${time}</span>
            <span class="lt-src app">${log.source || 'APP'}</span>
          </div>
        </div>`;
      container.insertAdjacentHTML('beforeend', row);
    });
  });
}

function filterLog(el, type){
  document.querySelectorAll('.hfc').forEach(x => x.className = 'hfc off');
  el.className = 'hfc on';
  document.querySelectorAll('.lrow').forEach(r => {
    r.style.display = (type === 'all' || r.dataset.type === type) ? 'flex' : 'none';
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCHEDULES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadSchedules(){
  if(!authToken) return;

  try {
    const response = await fetch(`${API_BASE}/schedules`, {
      headers: { 'Authorization': `Bearer ${authToken}` }
    });

    if(response.ok){
      const data = await response.json();
      const schedules = Array.isArray(data) ? data : (data.schedules || []);
      displaySchedules(schedules);
    }
  } catch(error){
    console.error('Error loading schedules:', error);
  }
}

function displaySchedules(schedules){
  const activeList = document.getElementById('scheduleActiveList');
  const inactiveList = document.getElementById('scheduleInactiveList');
  activeList.innerHTML = '';
  inactiveList.innerHTML = '';

  const active = schedules.filter(s => s.isActive !== false);
  const inactive = schedules.filter(s => s.isActive === false);

  if(active.length === 0) activeList.innerHTML = '<div style="padding:10px;color:var(--text3);font-size:12px;">Ch∆∞a c√≥ l·ªãch n√†o</div>';
  if(inactive.length === 0) inactiveList.innerHTML = '<div style="padding:10px;color:var(--text3);font-size:12px;">Ch∆∞a c√≥ l·ªãch n√†o</div>';

  active.forEach(s => {
    const isOpen = s.action === 'OPEN';
    const deviceName = 'C·ª≠a garage A1';
    const row = `
      <div class="sch-row ${isOpen ? 'so' : 'sc'}" data-id="${s.id}">
        <div class="sch-ico ${isOpen ? 'uo' : 'uc'}"><div class="${isOpen ? 'sau' : 'sad'}"></div></div>
        <div class="sch-info">
          <div class="sch-t">${s.cronTime.split(' ').slice(1,2).join(':') || '--:--'}</div>
          <div class="sch-s">${deviceName}</div>
          <div class="sch-r">H√†ng ${s.cronTime.includes('*') ? 'ng√†y' : 'tu·∫ßn'}</div>
          <span class="sch-badge ${isOpen ? 'open' : 'close'}">${isOpen ? 'M·ªû C·ª¨A' : 'ƒê√ìNG C·ª¨A'}</span>
        </div>
        <div class="sch-actions">
          <div class="tog on" onclick="toggleSchedule('${s.id}', this)"></div>
          <div class="sch-del" onclick="delSchedule('${s.id}')">‚úï</div>
        </div>
      </div>`;
    activeList.insertAdjacentHTML('beforeend', row);
  });

  inactive.forEach(s => {
    const isOpen = s.action === 'OPEN';
    const deviceName = 'C·ª≠a garage A1';
    const row = `
      <div class="sch-row ${isOpen ? 'so' : 'sc'}" data-id="${s.id}" style="opacity:.45">
        <div class="sch-ico ${isOpen ? 'uo' : 'uc'}"><div class="${isOpen ? 'sau' : 'sad'}"></div></div>
        <div class="sch-info">
          <div class="sch-t">${s.cronTime.split(' ').slice(1,2).join(':') || '--:--'}</div>
          <div class="sch-s">${deviceName}</div>
          <div class="sch-r">H√†ng ${s.cronTime.includes('*') ? 'ng√†y' : 'tu·∫ßn'}</div>
          <span class="sch-badge ${isOpen ? 'open' : 'close'}">${isOpen ? 'M·ªû C·ª¨A' : 'ƒê√ìNG C·ª¨A'}</span>
        </div>
        <div class="sch-actions">
          <div class="tog" onclick="toggleSchedule('${s.id}', this)"></div>
          <div class="sch-del" onclick="delSchedule('${s.id}')">‚úï</div>
        </div>
      </div>`;
    inactiveList.insertAdjacentHTML('beforeend', row);
  });
}

function toggleSchedule(id, el){
  el.classList.toggle('on');
  el.closest('.sch-row').style.opacity = el.classList.contains('on') ? '1' : '.45';
}

async function delSchedule(id){
  if(!authToken) return;
  if(!confirm('X√≥a l·ªãch n√†y?')) return;

  try {
    const response = await fetch(`${API_BASE}/schedules/${id}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${authToken}` }
    });

    if(response.ok){
      const row = document.querySelector(`[data-id="${id}"]`);
      if(row){
        row.style.transform = 'translateX(100%)';
        row.style.opacity = '0';
        row.style.transition = 'all .3s';
        setTimeout(() => row.remove(), 300);
      }
      loadUserStats();
    }
  } catch(error){
    console.error('Error deleting schedule:', error);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADD SCHEDULE MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let selAction = 'OPEN';

function openAddSchedule(){
  selAction = 'OPEN';
  document.getElementById('actOpen').className = 'act-opt sel-open';
  document.getElementById('actClose').className = 'act-opt';
  document.getElementById('f-time').value = '07:00';
  document.querySelectorAll('.day-cb').forEach(d => d.classList.remove('on'));
  document.getElementById('repeatPreview').textContent = 'Ch∆∞a ch·ªçn ng√†y';
  document.getElementById('fTogActive').className = 'tog on';
  document.getElementById('fTogNotify').className = 'tog on';
  document.getElementById('addModal').classList.add('show');
}

function closeAddSchedule(){
  document.getElementById('addModal').classList.remove('show');
}

function handleModalClick(e){
  if(e.target === document.getElementById('addModal')) closeAddSchedule();
}

function selectAction(a){
  selAction = a;
  document.getElementById('actOpen').className = 'act-opt' + (a === 'OPEN' ? ' sel-open' : '');
  document.getElementById('actClose').className = 'act-opt' + (a === 'CLOSE' ? ' sel-close' : '');
}

const DAY_NAMES = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];

function toggleDay(el){
  el.classList.toggle('on');
  updateRepeatPreview();
}

function updateRepeatPreview(){
  const sel = [...document.querySelectorAll('.day-cb.on')].map(d => DAY_NAMES[d.dataset.d]);
  if(sel.length === 0) { document.getElementById('repeatPreview').textContent = 'Ch∆∞a ch·ªçn ng√†y'; return; }
  if(sel.length === 7) { document.getElementById('repeatPreview').textContent = '‚Üª H√†ng ng√†y'; return; }
  document.getElementById('repeatPreview').textContent = '‚Üª ' + sel.join(' ');
}

async function saveSchedule(){
  if(!authToken) { showLoginPage(); return; }

  const time = document.getElementById('f-time').value;
  const days = [...document.querySelectorAll('.day-cb.on')].map(d => d.dataset.d);
  const isActive = document.getElementById('fTogActive').classList.contains('on');

  if(days.length === 0) {
    alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ng√†y');
    return;
  }

  // Convert to cron format: "minute hour * * day_of_week"
  const [h, m] = time.split(':');
  const cronTime = `${m} ${h} * * ${days.join(',')}`;

  try {
    const response = await fetch(`${API_BASE}/schedules`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${authToken}`
      },
      body: JSON.stringify({
        action: selAction,
        cronTime: cronTime
      })
    });

    if(response.ok){
      closeAddSchedule();
      loadSchedules();
      loadUserStats();
    } else {
      const data = await response.json();
      alert(data.message || 'L·ªói khi t·∫°o l·ªãch');
    }
  } catch(error){
    console.error('Error saving schedule:', error);
    alert('L·ªói: ' + error.message);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOGOUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function doLogout(){
  authToken = null;
  currentUser = null;
  localStorage.removeItem('authToken');
  localStorage.removeItem('currentUser');
  showLoginPage();
  document.getElementById('f-email').value = '';
  document.getElementById('f-pass').value = '';
  document.getElementById('errMsg').classList.remove('show');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INITIALIZATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', e => {
  if(e.key === 'Enter' && document.getElementById('loginPage').style.display !== 'none') doLogin();
});

// Check if user already logged in
if(authToken && currentUser){
  showAppPage();
  loadUserData();
}

// Add CSS for shake animation
const style = document.createElement('style');
style.textContent = '@keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(6px); } 20%, 40%, 60%, 80% { transform: translateX(-6px); } }';
document.head.appendChild(style);
</script>
</body>
</html>
